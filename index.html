<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MEDULA ‚Äî Portal Paciente</title>
  <link rel="stylesheet" href="medula.css">
</head>
<body>
  <a href="#historial" class="skip-link">Saltar al contenido</a>

  <div class="app">
    <!-- ============ SIDEBAR ============ -->
    <aside class="sidebar">
      <!-- Encabezado Marca + Usuario (AHORA SOLO IMAGEN) -->
      <div class="side-header p-6">
        <!-- Banner de marca (solo imagen) -->
        <a class="brand-banner" href="#historial" aria-label="Ir al inicio">
          <!-- Usa tu imagen larga aqu√≠ -->
          <img src="assets/img/medula_largo_slogan.png" alt="MEDULA" />
          <!-- Si prefieres tu archivo actual: assets/img/medula_.png -->
        </a>

        <!-- Bot√≥n de usuario (abre perfil) -->
        <button class="user-card" type="button" aria-label="Abrir perfil de usuario" id="userCardBtn">
          <div class="user-avatar" aria-hidden="true">MG</div>
          <div class="user-info">
            <div class="user-name">Mar√≠a Gonz√°lez</div>
            <div class="user-rut">12.345.678-9</div>
          </div>
          <a href="#perfil" class="stretched-link" aria-hidden="true" tabindex="-1"></a>
        </button>
      </div>

      <!-- Navegaci√≥n -->
      <nav class="p-6" aria-label="Secciones">
        <a href="#historial" id="link-historial" class="active"><span class="nav-icon">üóÇÔ∏è</span> Historial M√©dico</a>
        <a href="#medicamentos" id="link-medicamentos"><span class="nav-icon">üíä</span> Mis Medicamentos</a>
        <a href="#examenes" id="link-examenes"><span class="nav-icon">üß™</span> Resultados de Ex√°menes</a>
        <a href="#perfil" id="link-perfil"><span class="nav-icon">üë§</span> Mi Perfil</a>
      </nav>

      <!-- Controles -->
      <div class="p-6 side-footer">
        <div class="space-y-3">
          <div class="flex gap-3">
            <button class="btn btn-outline" id="btn-font" aria-pressed="false">A+ Tama√±o</button>
            <button class="btn btn-outline" id="btn-dark" aria-pressed="false">Modo Noche</button>
          </div>
          <div class="flex gap-3">
            <button class="btn" id="btn-allow-notif" title="Permitir avisos en este dispositivo">üîî Permitir avisos</button>
            <button class="btn" id="btn-export-all" title="Exportar todos los recordatorios como .ics">üóÇÔ∏è Exportar todo</button>
          </div>
          <a id="btn-sync-gcal" class="btn" target="_blank" rel="noopener" href="https://calendar.google.com/calendar/u/0/r/settings/import">üîÑ Sincronizar con Google</a>
          <button class="btn" id="btn-logout">‚Ü©Ô∏è Cerrar Sesi√≥n</button>
        </div>
      </div>
    </aside>

    <!-- ============ CONTENIDO PRINCIPAL ============ -->
    <main class="main">
      <div class="p-6">
        <!-- HISTORIAL -->
        <section class="section" id="historial">
          <div class="space-y-7">
            <div class="flex items-center between">
              <h2 class="page-title">Historial M√©dico</h2>
              <button class="btn btn-primary" id="btn-print">‚¨áÔ∏è Descargar PDF</button>
            </div>

            <div class="space-y-5">
              <div class="card p-5">
                <div class="entry">
                  <div class="entry-left">
                    <div class="icon-circle" aria-hidden="true">üìà</div>
                    <div>
                      <div class="flex items-center gap-2">
                        <h3 class="entry-title">Control General</h3>
                        <span class="badge badge-brand">15 Ene 2024</span>
                      </div>
                      <p class="subtitle">Dra. Valentina Araya</p>
                      <p>Diagn√≥stico: Estado saludable. Control en 6 meses.</p>
                    </div>
                  </div>
                  <button class="btn btn-ghost view-btn"
                          data-title="Control General"
                          data-detail="Dra. Valentina Araya ‚Äî 15 Ene 2024\nDiagn√≥stico: Estado saludable. Control en 6 meses.">üëÅÔ∏è Ver</button>
                </div>
              </div>

              <div class="card p-5">
                <div class="entry">
                  <div class="entry-left">
                    <div class="icon-circle" aria-hidden="true">üìà</div>
                    <div>
                      <div class="flex items-center gap-2">
                        <h3 class="entry-title">Consulta Nutrici√≥n</h3>
                        <span class="badge badge-brand">02 Mar 2024</span>
                      </div>
                      <p class="subtitle">Nut. Camilo Vega</p>
                      <p>Diagn√≥stico: Ajuste de dieta mediterr√°nea.</p>
                    </div>
                  </div>
                  <button class="btn btn-ghost view-btn"
                          data-title="Consulta Nutrici√≥n"
                          data-detail="Nut. Camilo Vega ‚Äî 02 Mar 2024\nDiagn√≥stico: Ajuste de dieta mediterr√°nea.">üëÅÔ∏è Ver</button>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- MEDICAMENTOS -->
        <section class="section" id="medicamentos" hidden>
          <div class="space-y-7">
            <h2 class="page-title">Mis Medicamentos</h2>

            <div class="space-y-5">
              <div class="card p-5">
                <div class="med-row">
                  <div class="flex items-center gap-4">
                    <div class="pill-icon" aria-hidden="true">üíä</div>
                    <div>
                      <h3 class="entry-title">Metformina</h3>
                      <p class="subtitle">850 mg ‚Äî 1 cada 12h</p>
                      <p>Pr√≥xima dosis: hoy 20:00</p>
                    </div>
                  </div>
                  <div class="stock">
                    <p>Stock: 8 d√≠as</p>
                    <div class="progress" aria-label="progreso stock"><span style="width:28%"></span></div>
                  </div>
                </div>
              </div>

              <div class="card p-5">
                <div class="med-row">
                  <div class="flex items-center gap-4">
                    <div class="pill-icon" aria-hidden="true">üíä</div>
                    <div>
                      <h3 class="entry-title">Losart√°n</h3>
                      <p class="subtitle">50 mg ‚Äî 1 diaria</p>
                      <p>Pr√≥xima dosis: ma√±ana 08:00</p>
                    </div>
                  </div>
                  <div class="stock">
                    <p>Stock: 22 d√≠as</p>
                    <div class="progress" aria-label="progreso stock"><span style="width:73%"></span></div>
                  </div>
                </div>
              </div>

            </div>
          </div>
        </section>

        <!-- EX√ÅMENES -->
        <section class="section" id="examenes" hidden>
          <div class="space-y-7">
            <h2 class="page-title">Resultados de Ex√°menes</h2>

            <div class="space-y-5">
              <div class="card p-5">
                <div class="flex items-center between">
                  <div class="flex items-center gap-4">
                    <div class="doc-icon" aria-hidden="true">üìÑ</div>
                    <div>
                      <h3 class="entry-title">Perfil Lip√≠dico</h3>
                      <p class="subtitle">15 Dic 2023</p>
                      <span class="badge ok">‚úÖ Normal</span>
                    </div>
                  </div>
                  <button class="btn btn-ghost view-btn" data-title="Perfil Lip√≠dico" data-detail="15 Dic 2023 ‚Äî Resultado: Normal">üëÅÔ∏è Ver</button>
                </div>
              </div>

              <div class="card p-5">
                <div class="flex items-center between">
                  <div class="flex items-center gap-4">
                    <div class="doc-icon" aria-hidden="true">üìÑ</div>
                    <div>
                      <h3 class="entry-title">Hemograma Completo</h3>
                      <p class="subtitle">28 Nov 2023</p>
                      <span class="badge ok">‚úÖ Normal</span>
                    </div>
                  </div>
                  <button class="btn btn-ghost view-btn" data-title="Hemograma Completo" data-detail="28 Nov 2023 ‚Äî Resultado: Normal">üëÅÔ∏è Ver</button>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- PERFIL -->
        <section class="section" id="perfil" hidden>
          <div class="space-y-7">
            <h2 class="page-title">Mi Perfil</h2>

            <div class="card">
              <div class="p-5">
                <h3 class="section-subtitle">Informaci√≥n Personal</h3>
                <div class="space-y-5">
                  <div class="grid-2">
                    <div>
                      <div class="label">Nombre Completo</div>
                      <p class="value">Mar√≠a Esperanza Gonz√°lez P√©rez</p>
                    </div>
                    <div>
                      <div class="label">RUT</div>
                      <p class="value">12.345.678-9</p>
                    </div>
                    <div>
                      <div class="label">Fecha de Nacimiento</div>
                      <p class="value">15 de Marzo, 1985</p>
                    </div>
                    <div>
                      <div class="label">Edad</div>
                      <p class="value">38 a√±os</p>
                    </div>
                  </div>

                  <div class="separator"></div>

                  <div class="grid-2">
                    <div>
                      <div class="label">Plan FONASA</div>
                      <p class="value">Tramo B</p>
                    </div>
                    <div>
                      <div class="label">Centro de Salud</div>
                      <p class="value">CESFAM La Florida</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>

      </div>
    </main>

    <!-- ============ PANEL DERECHO (Formulario + Buscador + Calendario + Citas) ============ -->
    <aside class="right p-6 space-y-8">
      <!-- Formulario nuevo recordatorio -->
      <div class="card" aria-labelledby="formTitle">
        <div class="p-5 space-y-4">
          <h3 id="formTitle">‚ûï Nuevo recordatorio</h3>
          <form id="reminderForm" class="grid-2" autocomplete="off">
            <div class="field">
              <label for="title" class="label">T√≠tulo *</label>
              <input id="title" name="title" type="text" required placeholder="Ej: Consulta cardiolog√≠a" />
            </div>
            <div class="field">
              <label for="type" class="label">Tipo *</label>
              <select id="type" name="type" required>
                <option value="consulta">Consulta</option>
                <option value="examen">Examen</option>
                <option value="medicamento">Medicamento</option>
              </select>
            </div>
            <div class="field">
              <label for="date" class="label">Fecha *</label>
              <input id="date" name="date" type="date" required />
            </div>
            <div class="field">
              <label for="time" class="label">Hora</label>
              <input id="time" name="time" type="time" />
            </div>
            <div class="field">
              <label for="location" class="label">Lugar</label>
              <input id="location" name="location" type="text" placeholder="Cl√≠nica, direcci√≥n o virtual" />
            </div>
            <div class="field">
              <label for="notes" class="label">Notas</label>
              <textarea id="notes" name="notes" placeholder="Indicaciones, preparaci√≥n, etc."></textarea>
            </div>
            <div class="field field-actions">
              <button type="submit" class="btn btn-primary">üíæ A√±adir al calendario</button>
              <button type="button" id="exportICSBtn" class="btn">üì• Guardar y exportar .ics</button>
              <span id="formStatus" class="subtitle" aria-live="polite"></span>
            </div>
          </form>
        </div>
      </div>

      <!-- Buscador global accesible (sticky) -->
      <div class="global-search" role="search" aria-label="Buscar eventos">
        <label for="searchBox" class="sr-only">Buscar eventos</label>
        <div class="global-search__wrap">
          <span class="global-search__icon" aria-hidden="true">üîé</span>
          <input
            id="searchBox"
            type="text"
            placeholder="Buscar eventos"
            aria-label="Buscar eventos por t√≠tulo, lugar o notas"
          />
        </div>
      </div>

      <!-- Calendario -->
      <div class="calendar" aria-label="Calendario">
        <div class="cal-head">
          <div class="cal-actions">
            <button class="btn" id="prevMonth" aria-label="Mes anterior">‚óÄ</button>
            <button class="btn" id="todayBtn" aria-label="Ir a hoy">Hoy</button>
            <button class="btn" id="nextMonth" aria-label="Mes siguiente">‚ñ∂</button>
          </div>
          <div class="cal-title"><span id="monthName">‚Äî</span> <span id="yearNum">‚Äî</span></div>
          <div class="cal-toolbar">
            <div class="segmented" role="group" aria-label="Cambiar vista">
              <button id="viewMonth" aria-pressed="true">Mes</button>
              <button id="viewWeek" aria-pressed="false">Semana</button>
              <button id="viewList" aria-pressed="false">Lista</button>
            </div>
          </div>
        </div>

        <div class="cal-legend" aria-hidden="true">
          <span><span class="cal-dot consulta"></span>Consulta</span>
          <span><span class="cal-dot examen"></span>Examen</span>
          <span><span class="cal-dot medicamento"></span>Medicamento</span>
        </div>

        <!-- Vistas -->
        <div id="monthView">
          <div class="cal-grid" id="calGrid"><!-- JS genera 42 celdas --></div>
        </div>

        <div id="weekView" hidden>
          <div class="week-grid" id="weekGrid"><!-- JS --></div>
        </div>

        <div id="listView" hidden>
          <div id="listWrap"><!-- JS --></div>
        </div>
      </div>

      <!-- Pr√≥ximas Citas -->
      <div class="card">
        <div class="p-5">
          <div class="flex between items-center">
            <h3>üìÖ Pr√≥ximas Citas</h3>
            <div class="flex gap-2">
              <select id="filterType" aria-label="Filtrar por tipo" class="btn">
                <option value="all">Todas</option>
                <option value="consulta">Consulta</option>
                <option value="examen">Examen</option>
                <option value="medicamento">Medicamento</option>
              </select>
              <button id="clearAll" class="btn" title="Borrar todos">üóëÔ∏è</button>
            </div>
          </div>
          <div id="apptList" class="space-y-3" aria-live="polite"></div>
        </div>
      </div>

      <!-- Alertas -->
      <div class="card">
        <div class="p-5 space-y-3">
          <h3>‚ö†Ô∏è Alertas</h3>
          <div class="alert warn">
            <div class="alert-title">Medicamento por acabar</div>
            <div class="alert-text">Metformina ‚Äî 8 d√≠as restantes</div>
          </div>
          <div class="alert info">
            <div class="alert-title">Recordatorio</div>
            <div class="alert-text">Control cardiol√≥gico pendiente</div>
          </div>
        </div>
      </div>

      <!-- Emergencias -->
      <div class="card">
        <div class="p-5">
          <h3>‚òéÔ∏è Emergencias</h3>
          <div class="space-y-3 emg">
            <div>SAMU: 131</div>
            <div>Bomberos: 132</div>
            <div>Carabineros: 133</div>
            <div class="separator"></div>
            <div>‚úâÔ∏è medula@fonasa.cl</div>
          </div>
        </div>
      </div>
    </aside>
  </div>

  <!-- Modal gen√©rico -->
  <div class="modal" id="modal">
    <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <div class="head">
        <strong id="modalTitle">Detalle</strong>
        <button class="btn" id="closeModal" aria-label="Cerrar">‚úñ</button>
      </div>
      <div class="body">
        <pre id="modalBody" class="modal-pre"></pre>
      </div>
    </div>
  </div>

  <!-- JS -->
  <script src="medula.js" defer></script>
</body>
</html>
